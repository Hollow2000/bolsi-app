import{a as B}from"./chunk-M26R77LO.js";import{a as G,b as Y,c as f,d as Q,e as J,f as O,g as v,h as K,m as X,n as Z,o as ee,p as x}from"./chunk-XENJULYC.js";import{c as z,d as M,f as P,g as T,k as W}from"./chunk-7MYF4U2T.js";import{a as R}from"./chunk-V4IFG5G7.js";import"./chunk-7HPGID4D.js";import{a as U,b as q}from"./chunk-L46ZHKVX.js";import"./chunk-YHS6ELTG.js";import{a as S}from"./chunk-QWSRSP2M.js";import{$a as L,Ba as s,Fa as w,Ja as D,La as I,Oa as y,P as h,Ua as _,V as d,Va as b,W as u,Ya as E,_a as A,ab as i,bb as a,cb as H,db as F,fa as N,gb as m,hb as p,nb as C,ob as l,pb as j,qb as $}from"./chunk-6WEJXUXI.js";import{f as V}from"./chunk-EQDQRRRY.js";var k=class r{constructor(t,e){this.el=t;this.ngControl=e}onInputChange(t){let e=t.target,n=e.value.replace(/[^0-9]/g,"");n.length>2&&(n=n.substring(0,2)),this.ngControl.control?.setValue(n),e.value=n?`${n}%`:"",e.selectionEnd=e.value.length-1}onClick(){let t=this.el.nativeElement,e=t.selectionStart??0;if(t.value.endsWith("%")){let n=t.value.length-1;e>=n&&t.setSelectionRange(n,n)}}onFocus(){let t=this.el.nativeElement,e=t.value.length-1;t.value.endsWith("%")&&setTimeout(()=>{t.setSelectionRange(e,e)})}static \u0275fac=function(e){return new(e||r)(w(N),w(Q,10))};static \u0275dir=I({type:r,selectors:[["","appPercent",""]],hostBindings:function(e,n){e&1&&m("input",function(c){return n.onInputChange(c)})("click",function(){return n.onClick()})("focus",function(){return n.onFocus()})}})};var oe=(r,t)=>t.controls.id.value;function re(r,t){if(r&1){let e=F();i(0,"div",23,3),H(2,"input",24),i(3,"input",25),m("input",function(){d(e);let o=p(2);return u(o.calculateTotal())}),a(),i(4,"button",26),m("click",function(o){let c=d(e).$implicit,g=p(2);return o.preventDefault(),u(g.deletePocket(c.value.id,c.value.name))}),i(5,"mat-icon",27),l(6,"delete"),a()()()}if(r&2){let e=t.$implicit,n=C(1),o=p(2);b("form",o.pocketEdit===n),_("@animate",void 0),s(2),_("formControl",e.controls.name),s(),_("formControl",e.controls.percent)}}function ae(r,t){r&1&&(i(0,"span",21),l(1,"Favor de verificar los porcenajes"),a())}function le(r,t){if(r&1){let e=F();i(0,"div",5)(1,"h2",6),l(2,"Porcentaje total:"),a(),i(3,"h2",6),l(4),a()(),i(5,"div",7,0)(7,"div",8),A(8,re,7,5,"div",9,oe),i(10,"app-add-element",10,1),m("onClose",function(){d(e);let o=p();return u(o.newPocketForm.reset())}),i(12,"div",11)(13,"h3",12),l(14,"Nuevo bolsillo"),a(),i(15,"div",13)(16,"input",14),m("keydown.enter",function(){d(e);let o=C(18);return u(o.focus())}),a(),i(17,"input",15,2),m("keydown.enter",function(o){d(e);let c=C(11),g=p();return o.preventDefault(),u(g.submitNew(c))}),a()(),i(19,"div",16)(20,"button",17),m("click",function(o){d(e);let c=C(11),g=p();return o.preventDefault(),u(g.cancelNew(c))}),l(21," Cancelar "),i(22,"mat-icon",18),l(23,"cancel"),a()(),i(24,"button",19),m("click",function(o){d(e);let c=C(11),g=p();return o.preventDefault(),u(g.submitNew(c))}),l(25," Confirmar "),i(26,"mat-icon",18),l(27,"check_circle"),a()()()()()()(),i(28,"div",20),y(29,ae,2,0,"span",21),i(30,"button",22),m("click",function(o){d(e);let c=p();return o.preventDefault(),u(c.submitALL())}),l(31," Guardar "),i(32,"mat-icon",18),l(33,"save"),a()()()}if(r&2){let e=p();s(3),b("invalid",e.totalPercent!==100),s(),$("",e.totalPercent,"%"),s(4),L(e.arrayPocketForm.controls),s(2),_("@animate",void 0),s(6),_("formControl",e.newPocketForm.controls.name),s(),_("formControl",e.newPocketForm.controls.percent),s(12),E(e.totalPercent!==100?29:-1),s(),_("disabled",e.arrayPocketForm.untouched||e.totalPercent!==100)}}function ce(r,t){if(r&1&&(i(0,"h1",4),l(1),a()),r&2){let e=p();s(),j(e.errorMessage)}}var te=class r{pocketService=h(B);alertService=h(W);initialConfigService=h(R);totalPercent=0;pocketEdit;newPocketForm=new O({name:new v(null,[f.required,f.minLength(3)]),percent:new v(null,[f.required,f.min(1)])});arrayPocketForm=new Z([]);errorMessage;get Icons(){return q}ngOnInit(){this.pocketService.getObservable().subscribe(t=>{if(t.length===0&&!this.initialConfigService.isDone){this.pocketService.initPockets();return}try{this.arrayPocketForm.clear(),this.totalPercent=0,t.forEach(e=>{this.arrayPocketForm.push(new O({id:new v(e.id),name:new v(e.name,[f.required,f.minLength(3)]),percent:new v(`${e.percentEstimated}%`,[f.required,f.min(1)])})),this.totalPercent+=Number(e.percentEstimated)}),this.arrayPocketForm.updateValueAndValidity()}catch(e){this.errorMessage="Error al cargar los bolsillos: "+e.message}},t=>{this.errorMessage="Error al cargar los bolsillos: "+t.message,this.totalPercent=100}),this.initialConfigService.previousPage="",this.initialConfigService.nextPage=`${S.INIT_CONFIG}/${S.PAYMENT_METHODS}`}hasUnsaveChanges(){return this.totalPercent!==100||this.arrayPocketForm.touched?(this.alertService.addInfo("Los porcentajes deben sumar 100% y guardar los cambios para continuar"),!1):!0}calculateTotal(){this.arrayPocketForm.markAsTouched(),this.totalPercent=0,this.arrayPocketForm.value.forEach(t=>{this.totalPercent=this.totalPercent+x.clearNumberFormat(t.percent)})}submitNew(t){this.newPocketForm.valid?(this.pocketService.add({name:this.newPocketForm.value.name,percentEstimated:x.clearNumberFormat(this.newPocketForm.value.percent)}),this.cancelNew(t)):this.newPocketForm.markAllAsTouched()}cancelNew(t){this.newPocketForm.reset(),t.writing=!1}deletePocket(t,e){return V(this,null,function*(){(yield this.alertService.addQuestionYoNDanger(`\xBFDesea eliminar ${e}?`,"Eliminar bolsillo"))===2&&this.pocketService.delete(t)})}submitALL(){this.arrayPocketForm.valid?(this.pocketService.updatePockets(this.arrayPocketForm.value.map(t=>({id:t.id,name:t.name,percentEstimated:x.clearNumberFormat(t.percent)}))),this.arrayPocketForm.markAsUntouched()):this.arrayPocketForm.markAllAsTouched()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=D({type:r,selectors:[["app-pockets"]],decls:2,vars:1,consts:[["scroll",""],["addElement",""],["percent",""],["item",""],[1,"title-xlarge"],[1,"header"],[1,"title-large"],[1,"scroll"],[1,"content"],[1,"card","pocket",3,"form"],["label","Agregar bolsillo",3,"onClose"],[1,"card","form"],[1,"title-small"],[1,"pocket"],["autocomplete","off","type","text","name","name","id","name","tabindex","100","placeholder","Nombre del bolsillo",1,"text-medium","input",3,"keydown.enter","formControl"],["autocomplete","off","type","tel","name","percent","id","percent","placeholder","Porcentaje","tabindex","101","maxlength","3","appPercent","",1,"text-medium","input",3,"keydown.enter","formControl"],[1,"buttons-add"],[1,"btn-danger",3,"click"],["fontSet","material-symbols-rounded",2,"font-size","24px","color","white"],[1,"btn-success",3,"click"],[1,"footer"],[1,"label-error"],[1,"btn-primary",3,"click","disabled"],[1,"card","pocket"],["autocomplete","off","type","text","name","name","id","name","placeholder","Nombre del bolsillo","tabindex","1",1,"text-medium","input",3,"formControl"],["autocomplete","off","type","tel","name","percent","id","percent","placeholder","Porcentaje","tabindex","2","maxlength","3","appPercent","",1,"text-large","input",3,"input","formControl"],["id","delete",1,"btn-danger",3,"click"],["fontSet","material-symbols-rounded","color","white",2,"font-size","24px"]],template:function(e,n){e&1&&y(0,le,34,8)(1,ce,2,1,"h1",4),e&2&&E(n.errorMessage?1:0)},dependencies:[U,G,ee,Y,J,X,K,k],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:1rem;flex:1 1 auto;overflow:auto;margin:8px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end}.scroll[_ngcontent-%COMP%]{overflow-y:auto;flex:1 1 auto}.invalid[_ngcontent-%COMP%]{color:var(--error-color)}.content[_ngcontent-%COMP%]{max-width:var(--max-width);margin:0 auto;display:grid;gap:1rem;align-items:start;width:95%;padding:8px}@media (min-width: 600px){.content[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (min-width: 900px){.content[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.card[_ngcontent-%COMP%]{padding:1rem}.pocket[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:5px}.pocket[_ngcontent-%COMP%]   #name[_ngcontent-%COMP%]{width:70%}.pocket[_ngcontent-%COMP%]   #percent[_ngcontent-%COMP%]{width:30%;text-align:center}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.buttons-add[_ngcontent-%COMP%]{display:flex;gap:1rem}button[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:1rem;padding:.5rem}.pocket[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:50%}.footer[_ngcontent-%COMP%]{max-width:var(--max-width);margin:0 auto;width:100%}"],data:{animation:[z("animate",[T(":enter",[P({opacity:0,transform:"scale(0.8)"}),M("200ms ease-out",P({opacity:1,transform:"scale(1)"}))]),T(":leave",[M("150ms ease-in",P({opacity:0,transform:"scale(0.8)"}))])])]}})};export{te as PocketsComponent};
