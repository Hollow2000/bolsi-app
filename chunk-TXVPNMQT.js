import{a as se}from"./chunk-SH2X5BIO.js";import{a as ce}from"./chunk-ZBEO6VSQ.js";import{a as Y}from"./chunk-M26R77LO.js";import{a as Z,b as ie,c as y,e as ne,f as oe,g as F,h as re,m as le,o as ae,p as k}from"./chunk-XENJULYC.js";import{c as ee,d as G,f as S,g as $,k as te}from"./chunk-7MYF4U2T.js";import{a as z}from"./chunk-V4IFG5G7.js";import{a as W,b as K,c as A}from"./chunk-7HPGID4D.js";import{a as J,b as X}from"./chunk-L46ZHKVX.js";import{d as U}from"./chunk-YHS6ELTG.js";import{a as E}from"./chunk-QWSRSP2M.js";import{$a as T,Aa as I,Ba as c,J as L,Ja as j,Oa as M,P as h,Ua as x,V as u,Va as q,W as _,X as H,Ya as P,Za as R,_a as O,ab as r,bb as a,cb as V,db as w,gb as p,hb as s,nb as g,ob as m,pb as f,rb as Q,tb as N,ub as D}from"./chunk-6WEJXUXI.js";import{f as b}from"./chunk-EQDQRRRY.js";var B=class n extends K{table=A.billTable;getBillsGroupList$(){return W(()=>b(this,null,function*(){let t=yield A.pocketTable.toArray();return yield Promise.all(t.map(i=>b(this,null,function*(){let l=yield this.table.where("pocketId").equals(i.id).toArray(),o=l.reduce((d,C)=>d+C.amountEstimated,0);return{idPocket:i.id,pocketName:i.name,amountPocket:o,bills:l}})))}))}static \u0275fac=(()=>{let t;return function(i){return(t||(t=H(n)))(i||n)}})();static \u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})};var v=(o=>(o.Unique="Unico",o.Monthly="Mensual",o.Biweekly="Quincenal",o.Weekly="Semanal",o.Daily="Diario",o))(v||{});var pe=(n,t)=>t.pocketName;function ue(n,t){if(n&1){let e=w();r(0,"h3",14),m(1,"Editar gasto"),a(),r(2,"div",15)(3,"input",23),p("keydown.enter",function(l){u(e);let o=g(5);return l.preventDefault(),_(o.focus())}),a(),r(4,"input",24,2),p("keydown.enter",function(l){u(e);let o=s().$implicit,d=s().$implicit,C=s(2);return l.preventDefault(),_(C.submitEdit(o.id,d.idPocket))}),a(),V(6,"app-custom-select",18),a(),r(7,"div",19)(8,"button",25),p("click",function(l){u(e);let o=s(4);return l.preventDefault(),_(o.cancelEdit())}),m(9," Cancelar "),r(10,"mat-icon",21),m(11),a()(),r(12,"button",26),p("click",function(l){u(e);let o=s().$implicit,d=s().$implicit,C=s(2);return l.preventDefault(),_(C.submitEdit(o.id,d.idPocket))}),m(13," Confirmar "),r(14,"mat-icon",21),m(15),a()()()}if(n&2){let e=s(4);c(3),x("formControl",e.billForm.controls.description),c(),x("formControl",e.billForm.controls.amountEstimated),c(2),x("options",e.frecuencySelect)("formControlApp",e.billForm.controls.frecueny),c(5),f(e.Icons.CANCEL),c(4),f(e.Icons.CONFIRM)}}function _e(n,t){if(n&1){let e=w();r(0,"div",27)(1,"h3",9),m(2),a(),r(3,"span",28),m(4),N(5,"currency"),a(),r(6,"span",28),m(7),a()(),r(8,"div",29)(9,"button",30),p("click",function(l){u(e);let o=s().$implicit,d=g(1),C=s(3);return l.preventDefault(),_(C.openEdit(o,d))}),r(10,"mat-icon",31),m(11),a()(),r(12,"button",32),p("click",function(l){u(e);let o=s().$implicit,d=s(3);return l.preventDefault(),_(d.deleteBill(o.id,o.description))}),r(13,"mat-icon",31),m(14),a()()()}if(n&2){let e=s().$implicit,i=s(3);c(2),f(e.description),c(2),f(D(5,5,e.amountEstimated)),c(3),f(e.frecuency),c(4),f(i.Icons.EDIT),c(3),f(i.Icons.DELETE)}}function fe(n,t){if(n&1&&(r(0,"div",11,3),M(2,ue,16,6)(3,_e,15,7),a()),n&2){let e=g(1),i=s(3);q("form",i.billEdit===e),x("@animate",void 0),c(2),P(i.billEdit===e?2:3)}}function xe(n,t){n&1&&(r(0,"div",11,3)(2,"h3",9),m(3,"Aun no tienes gastos en este bolsillo"),a()()),n&2&&x("@animate",void 0)}function Ce(n,t){if(n&1){let e=w();r(0,"div",8)(1,"h3",9),m(2),N(3,"currency"),a(),O(4,fe,4,4,"div",10,R,!1,xe,4,1,"div",11),r(7,"app-add-element",12,1),p("onClose",function(){u(e);let l=s(2);return _(l.billForm.reset({frecueny:""}))}),r(9,"div",13)(10,"h3",14),m(11,"Registrar nuevo gasto"),a(),r(12,"div",15)(13,"input",16),p("keydown.enter",function(){u(e);let l=g(15);return _(l.focus())}),a(),V(14,"input",17,2)(16,"app-custom-select",18),a(),r(17,"div",19)(18,"button",20),p("click",function(l){u(e);let o=g(8),d=s(2);return l.preventDefault(),_(d.cancelNew(o))}),m(19," Cancelar "),r(20,"mat-icon",21),m(21),a()(),r(22,"button",22),p("click",function(l){let o=u(e).$implicit,d=g(8),C=s(2);return l.preventDefault(),_(C.submitNew(d,o.idPocket))}),m(23," Confirmar "),r(24,"mat-icon",21),m(25),a()()()()()()}if(n&2){let e=t.$implicit,i=s(2);c(2),Q("",e.pocketName," ",D(3,10,e.amountPocket),""),c(2),T(e.bills),c(3),x("@animate",void 0),c(6),x("formControl",i.billForm.controls.description),c(),x("formControl",i.billForm.controls.amountEstimated),c(2),x("options",i.frecuencySelect)("formControlApp",i.billForm.controls.frecueny),c(5),f(i.Icons.CANCEL),c(4),f(i.Icons.CONFIRM)}}function be(n,t){if(n&1&&(r(0,"div",4)(1,"h2",5),m(2,"Gastos registrados"),a()(),r(3,"div",6,0)(5,"div",7),O(6,Ce,26,12,"div",8,pe),a()()),n&2){let e=s();c(6),T(e.billsGroups)}}function ge(n,t){if(n&1&&(r(0,"div")(1,"h1",33),m(2),a()()),n&2){let e=s();c(2),f(e.errorMessage)}}var me=class n{initialConfigService=h(z);alertService=h(te);billService=h(B);pocketService=h(Y);billsGroups;billEdit;errorMessage;billForm=new oe({description:new F(null,[y.required,y.minLength(5),y.maxLength(30)]),amountEstimated:new F(null,[y.required,y.maxLength(11)]),frecueny:new F("",[y.required])});get Icons(){return X}frecuencySelect;pocketsSelect;get Frecuency(){return v}get frecuencySelected(){return v[this.billForm.value.frecueny]}ngOnInit(){return b(this,null,function*(){this.billService.getBillsGroupList$().subscribe(t=>{this.billsGroups=t},t=>{this.errorMessage=`Error al cargar los gastos: ${t.message}`}),this.frecuencySelect=Object.keys(v).map(t=>({key:t,text:v[t]})),this.pocketsSelect=yield(yield this.pocketService.getList()).map(t=>({text:t.name,key:t.id})),this.initialConfigService.nextPage=`${E.INIT_CONFIG}/${E.QUICK_SHOPPING}`,this.initialConfigService.previousPage=`${E.INIT_CONFIG}/${E.INCOME}`})}outInteraction(t){this.billEdit&&!this.billEdit.contains(t.target)&&this.cancelEdit()}submitNew(t,e){return b(this,null,function*(){this.billForm.valid?(yield this.billService.add({description:this.billForm.value.description,amountEstimated:k.clearNumberFormat(this.billForm.value.amountEstimated),frecuency:this.frecuencySelected,pocketId:e}),this.billForm.reset({frecueny:""}),t.writing=!1):this.billForm.markAllAsTouched()})}cancelNew(t){this.billForm.reset({frecueny:""}),t.writing=!1}openEdit(t,e){this.billEdit=e,this.billForm.patchValue({description:t.description,amountEstimated:k.transformCurrencyFormat(t.amountEstimated),frecueny:this.frecuencySelect?.find(i=>i.text===t.frecuency)?.key||""}),setTimeout(()=>{requestAnimationFrame(()=>{e.scrollIntoView({behavior:"smooth",block:"nearest"})})},100)}cancelEdit(){this.billForm.reset({frecueny:""}),this.billEdit=void 0}submitEdit(t,e){return b(this,null,function*(){if(this.billForm.valid)try{yield this.billService.update(t,{description:this.billForm.value.description,amountEstimated:k.clearNumberFormat(this.billForm.value.amountEstimated),frecuency:this.frecuencySelected,pocketId:e}),this.cancelEdit()}catch(i){this.alertService.addError("Error al actualizar el gasto: "+(i?.message||i))}else this.billForm.markAllAsTouched()})}deleteBill(t,e){return b(this,null,function*(){(yield this.alertService.addQuestionYoNDanger(`\xBFDesea eliminar ${e}?`,"Eliminar gasto"))===2&&this.billService.delete(t)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=j({type:n,selectors:[["app-bills"]],hostBindings:function(e,i){e&1&&p("touchstart",function(o){return i.outInteraction(o)},!1,I)("mousedown",function(o){return i.outInteraction(o)},!1,I)},decls:2,vars:1,consts:[["scroll",""],["addElement",""],["amount",""],["item",""],[1,"header"],[1,"title-large"],[1,"scroll"],[1,"content"],[1,"group"],[1,"title-medium"],[1,"card","bill",3,"form"],[1,"card","bill"],["label","Registrar nuevo gasto",3,"onClose"],[1,"card","form"],[1,"title-small"],[1,"form"],["autocomplete","off","type","text","name","description","id","description","tabindex","1","placeholder","Nombre/Alias/Concepto",1,"text-medium","input",3,"keydown.enter","formControl"],["autocomplete","off","type","tel","name","amount","id","amount","placeholder","Cantidad","appCurrency","","tabindex","2",1,"text-medium","input",3,"formControl"],["placeHolder","Frecuencia del gasto","id","frecuency",3,"options","formControlApp"],[1,"buttons-add"],[1,"btn-danger",3,"click"],["fontSet","material-symbols-rounded",2,"font-size","24px","color","white"],[1,"btn-success",3,"click"],["autocomplete","off","type","text","name","description","id","description","placeholder","Descripci\xF3n/Alias/Concepto","tabindex","1","maxlength","30",1,"text-medium","input",3,"keydown.enter","formControl"],["autocomplete","off","type","tel","name","amount","id","amount","placeholder","Cantidad","appCurrency","","tabindex","2","maxlength","11",1,"text-medium","input",3,"keydown.enter","formControl"],["tabindex","3",1,"btn-danger",3,"click"],["tabindex","4",1,"btn-success",3,"click"],[1,"info"],[1,"text-large"],[1,"actions"],["id","edit",1,"btn-primary",3,"click"],["fontSet","material-symbols-rounded","color","white",2,"font-size","24px"],["id","delete",1,"btn-danger",3,"click"],[1,"title-xlarge"]],template:function(e,i){e&1&&M(0,be,8,0)(1,ge,3,1,"div"),e&2&&P(i.billsGroups&&!i.errorMessage?0:1)},dependencies:[Z,J,ae,ie,ne,le,re,U,ce,se],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:1rem;flex:1 1 auto;overflow:auto;margin:8px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end}.scroll[_ngcontent-%COMP%]{overflow-y:auto;flex:1 1 auto}.content[_ngcontent-%COMP%]{max-width:var(--max-width);margin:0 auto;display:grid;gap:1rem;align-items:start;width:95%;padding:8px}.group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-bottom:1rem}@media (min-width: 600px){.content[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (min-width: 1130px){.content[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.card.bill[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:1rem}.info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:50%;display:flex;align-items:center;justify-content:center;padding:.5rem}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.buttons-add[_ngcontent-%COMP%]{display:flex;gap:1rem}.buttons-add[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:1rem;padding:.5rem}"],data:{animation:[ee("animate",[$(":enter",[S({opacity:0,transform:"scale(0.8)"}),G("200ms ease-out",S({opacity:1,transform:"scale(1)"}))]),$(":leave",[G("150ms ease-in",S({opacity:0,transform:"scale(0.8)"}))])])]}})};export{me as BillsComponent};
