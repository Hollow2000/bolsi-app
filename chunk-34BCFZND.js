import{a as b,b as j}from"./chunk-IIOFZQBJ.js";import{a as nt}from"./chunk-SH2X5BIO.js";import{a as et}from"./chunk-ZBEO6VSQ.js";import{a as W,b as U,c as _,e as Y,f as J,g as v,h as X,m as Z,o as tt,p as y}from"./chunk-XENJULYC.js";import{c as K,d as V,f as O,g as k,k as Q}from"./chunk-7MYF4U2T.js";import{a as B}from"./chunk-V4IFG5G7.js";import"./chunk-7HPGID4D.js";import{a as R,b as G}from"./chunk-L46ZHKVX.js";import{d as q}from"./chunk-YHS6ELTG.js";import{a as E}from"./chunk-QWSRSP2M.js";import{$a as H,Aa as A,Ba as i,Ja as L,Oa as g,P as T,Ua as d,V as f,Va as N,W as x,Ya as M,_a as $,ab as o,bb as r,cb as h,db as F,gb as C,hb as l,nb as S,ob as m,pb as p,qb as P,rb as z,tb as D,ub as I}from"./chunk-6WEJXUXI.js";import{f as w}from"./chunk-EQDQRRRY.js";var at=(n,e)=>e.id;function rt(n,e){if(n&1&&h(0,"input",12)(1,"app-custom-select",13),n&2){let t=l(4);d("formControl",t.paymentMethodForm.controls.alias),i(),d("options",t.typeSelect)("formControlApp",t.paymentMethodForm.controls.type)}}function lt(n,e){if(n&1&&(o(0,"h3",10),m(1),r()),n&2){let t=l(2).$implicit;i(),p(t.type)}}function mt(n,e){if(n&1&&(o(0,"div",14),h(1,"input",23)(2,"input",24)(3,"input",25)(4,"input",26),r()),n&2){let t=l(4);i(),d("formControl",t.paymentMethodForm.controls.statementDay),i(),d("formControl",t.paymentMethodForm.controls.dayToPay),i(),d("formControl",t.paymentMethodForm.controls.amountCreditLimit),i(),d("formControl",t.paymentMethodForm.controls.amountCreditAvailable)}}function dt(n,e){if(n&1&&h(0,"input",15),n&2){let t=l(4);d("formControl",t.paymentMethodForm.controls.balance)}}function st(n,e){if(n&1){let t=F();o(0,"h3",10),m(1,"Editar forma de pago"),r(),o(2,"div",11),g(3,rt,2,3)(4,lt,2,1,"h3",10)(5,mt,5,4,"div",14)(6,dt,1,1,"input",15),r(),o(7,"div",16)(8,"button",21),C("click",function(s){f(t);let c=l(3);return s.preventDefault(),x(c.cancelEdit())}),m(9," Cancelar "),o(10,"mat-icon",18),m(11),r()(),o(12,"button",22),C("click",function(s){f(t);let c=l().$implicit,u=l(2);return s.preventDefault(),x(u.submitEdit(c.id))}),m(13," Confirmar "),o(14,"mat-icon",18),m(15),r()()()}if(n&2){let t=l().$implicit,a=l(2);i(3),M(t.type!==a.PaymentMethodType.Cash?3:4),i(2),M(t.type===a.PaymentMethodType.Credit?5:6),i(6),p(a.Icons.CANCEL),i(4),p(a.Icons.CONFIRM)}}function ct(n,e){if(n&1&&(o(0,"span",28),m(1),r(),o(2,"span",28),m(3),r(),o(4,"span",28),m(5),D(6,"currency"),r(),o(7,"span",28),m(8),D(9,"currency"),r()),n&2){let t=l(2).$implicit;i(),P("Fecha de corte: ",t.statementDay,""),i(2),P("Fecha de pago: ",t.daysToPay,""),i(2),P("Credito disponible: ",I(6,4,t.amountCreditAvailable),""),i(3),P("Limite de credito: ",I(9,6,t.amountCreditLimit),"")}}function pt(n,e){if(n&1&&(o(0,"span",28),m(1),D(2,"currency"),r()),n&2){let t=l(2).$implicit;i(),P("Disponible: ",I(2,1,t.balance),"")}}function yt(n,e){if(n&1){let t=F();o(0,"button",33),C("click",function(s){f(t);let c=l(2).$implicit,u=l(2);return s.preventDefault(),x(u.deletePaymentMethod(c))}),o(1,"mat-icon",31),m(2),r()()}if(n&2){let t=l(4);i(2),p(t.Icons.DELETE)}}function ut(n,e){if(n&1){let t=F();o(0,"div",27)(1,"h3",10),m(2),r(),g(3,ct,10,8)(4,pt,3,3,"span",28),r(),o(5,"div",29)(6,"button",30),C("click",function(s){f(t);let c=l().$implicit,u=S(1),ot=l(2);return s.preventDefault(),x(ot.openEdit(c,u))}),o(7,"mat-icon",31),m(8),r()(),g(9,yt,3,1,"button",32),r()}if(n&2){let t=l().$implicit,a=l(2);i(2),z("",t.type," ",t.type!==a.PaymentMethodType.Cash?t.alias:"",""),i(),M(t.type===a.PaymentMethodType.Credit?3:4),i(5),p(a.Icons.EDIT),i(),M(t.type!==a.PaymentMethodType.Cash?9:-1)}}function ht(n,e){if(n&1&&(o(0,"div",20,2),g(2,st,16,4)(3,ut,10,5),r()),n&2){let t=S(1),a=l(2);N("form",a.paymentMethodEdit===t),d("@animate",void 0),i(2),M(a.paymentMethodEdit===t?2:3)}}function Ct(n,e){if(n&1&&(o(0,"div",14)(1,"div",34),h(2,"input",23),o(3,"div",35)(4,"mat-icon",36),m(5),r(),o(6,"span",37),m(7,"D\xEDa del mes en que se hace el corte"),r()()(),o(8,"div",34),h(9,"input",24),o(10,"div",35)(11,"mat-icon",36),m(12),r(),o(13,"span",37),m(14,"N\xFAmero de d\xEDas despu\xE9s del corte para realizar el pago"),r()()(),h(15,"input",25)(16,"input",26),r()),n&2){let t=l(2);i(2),d("formControl",t.paymentMethodForm.controls.statementDay),i(3),p(t.Icons.HELP),i(4),d("formControl",t.paymentMethodForm.controls.dayToPay),i(3),p(t.Icons.HELP),i(3),d("formControl",t.paymentMethodForm.controls.amountCreditLimit),i(),d("formControl",t.paymentMethodForm.controls.amountCreditAvailable)}}function _t(n,e){if(n&1&&h(0,"input",15),n&2){let t=l(2);d("formControl",t.paymentMethodForm.controls.balance)}}function ft(n,e){if(n&1){let t=F();o(0,"div",3)(1,"h2",4),m(2,"M\xE9todos de pago"),r()(),o(3,"div",5,0)(5,"div",6),$(6,ht,4,4,"div",7,at),o(8,"app-add-element",8,1),C("onClose",function(){f(t);let s=l();return x(s.paymentMethodForm.reset({type:""}))}),o(10,"div",9)(11,"h3",10),m(12,"Nueva forma de pago"),r(),o(13,"div",11),h(14,"input",12)(15,"app-custom-select",13),g(16,Ct,17,6,"div",14)(17,_t,1,1,"input",15),r(),o(18,"div",16)(19,"button",17),C("click",function(s){f(t);let c=S(9),u=l();return s.preventDefault(),x(u.cancelNew(c))}),m(20," Cancelar "),o(21,"mat-icon",18),m(22),r()(),o(23,"button",19),C("click",function(s){f(t);let c=S(9),u=l();return s.preventDefault(),x(u.submitNew(c))}),m(24," Confirmar "),o(25,"mat-icon",18),m(26),r()()()()()()()}if(n&2){let t=l();i(6),H(t.paymentMethods),i(2),d("@animate",void 0),i(6),d("formControl",t.paymentMethodForm.controls.alias),i(),d("options",t.typeSelect)("formControlApp",t.paymentMethodForm.controls.type),i(),M(t.typeSelected===t.PaymentMethodType.Credit?16:t.typeSelected===t.PaymentMethodType.Debit?17:-1),i(6),p(t.Icons.CANCEL),i(4),p(t.Icons.CONFIRM)}}function xt(n,e){if(n&1&&(o(0,"div")(1,"h1",38),m(2),r()()),n&2){let t=l();i(2),p(t.errorMessage)}}var it=class n{paymentMethodService=T(j);alertService=T(Q);initialConfigService=T(B);paymentMethods;errorMessage;paymentMethodForm=new J({alias:new v(null,[_.required,_.maxLength(10)]),type:new v("",[_.required]),statementDay:new v(null,[]),dayToPay:new v(null,[]),amountCreditLimit:new v(null,[]),amountCreditAvailable:new v(null,[]),balance:new v(null,[])});paymentMethodEdit;get Icons(){return G}get PaymentMethodType(){return b}get typeSelect(){return Object.keys(b).filter(e=>e!=="Cash").map(e=>({key:e,text:b[e]}))}get typeSelected(){return b[this.paymentMethodForm.value.type]}ngOnInit(){this.paymentMethodService.getObservable().subscribe(e=>{if(e.length===0&&!this.initialConfigService.isDone){this.paymentMethodService.initPaymentMethods();return}this.paymentMethods=e},e=>{this.errorMessage="Error al cargar los m\xE9todos de pago: "+e.message}),this.paymentMethodForm.controls.type.valueChanges.subscribe(e=>{b[e]==="Tarjeta de credito"?(this.paymentMethodForm.controls.balance.clearValidators(),this.paymentMethodForm.controls.statementDay.setValidators([_.required]),this.paymentMethodForm.controls.dayToPay.setValidators([_.required]),this.paymentMethodForm.controls.amountCreditLimit.setValidators([_.required]),this.paymentMethodForm.controls.amountCreditAvailable.setValidators([_.required])):b[e]==="Tarjeta de debito"&&(this.paymentMethodForm.controls.statementDay.clearValidators(),this.paymentMethodForm.controls.dayToPay.clearValidators(),this.paymentMethodForm.controls.amountCreditLimit.clearValidators(),this.paymentMethodForm.controls.amountCreditAvailable.clearValidators(),this.paymentMethodForm.controls.balance.setValidators([_.required]))}),this.initialConfigService.nextPage=`${E.INIT_CONFIG}/${E.INCOME}`,this.initialConfigService.previousPage=`${E.INIT_CONFIG}/${E.POCKETS}`}outInteraction(e){this.paymentMethodEdit&&!this.paymentMethodEdit.contains(e.target)&&this.cancelEdit()}cancelEdit(){this.paymentMethodForm.reset({type:""}),this.paymentMethodEdit=void 0}openEdit(e,t){this.paymentMethodEdit=t,this.paymentMethodForm.patchValue({alias:e.alias,type:this.typeSelect.find(a=>a.text===e.type)?.key||"Cash",statementDay:e.statementDay??null,dayToPay:e.daysToPay??null,amountCreditLimit:e.amountCreditLimit?y.transformCurrencyFormat(e.amountCreditLimit):null,amountCreditAvailable:e.amountCreditAvailable?y.transformCurrencyFormat(e.amountCreditAvailable):null,balance:e.balance?y.transformCurrencyFormat(e.balance):null}),console.log(e),console.log(this.paymentMethodForm.value),setTimeout(()=>{requestAnimationFrame(()=>{t.scrollIntoView({behavior:"smooth",block:"nearest"})})},100)}submitEdit(e){return w(this,null,function*(){if(console.log(this.paymentMethodForm.valid),console.log(this.paymentMethodForm.value),this.paymentMethodForm.valid)try{yield this.paymentMethodService.update(e,{alias:this.paymentMethodForm.value.alias,type:this.typeSelected,statementDay:this.typeSelected==="Tarjeta de credito"?this.paymentMethodForm.value.statementDay:void 0,daysToPay:this.typeSelected==="Tarjeta de credito"?this.paymentMethodForm.value.dayToPay:void 0,amountCreditLimit:this.typeSelected==="Tarjeta de credito"?y.clearNumberFormat(this.paymentMethodForm.value.amountCreditLimit):void 0,amountCreditAvailable:this.typeSelected==="Tarjeta de credito"?y.clearNumberFormat(this.paymentMethodForm.value.amountCreditAvailable):void 0,balance:this.typeSelected!=="Tarjeta de credito"?y.clearNumberFormat(this.paymentMethodForm.value.balance):void 0}),this.cancelEdit()}catch(t){this.alertService.addError("Error al actualizar el m\xE9todo de pago: "+(t?.message||t))}else this.paymentMethodForm.markAllAsTouched()})}cancelNew(e){this.paymentMethodForm.reset({type:""}),e.writing=!1}submitNew(e){return w(this,null,function*(){if(this.paymentMethodForm.valid)try{yield this.paymentMethodService.add({alias:this.paymentMethodForm.value.alias,type:this.typeSelected,statementDay:this.typeSelected==="Tarjeta de credito"?this.paymentMethodForm.value.statementDay:void 0,daysToPay:this.typeSelected==="Tarjeta de credito"?this.paymentMethodForm.value.dayToPay:void 0,amountCreditLimit:this.typeSelected==="Tarjeta de credito"?y.clearNumberFormat(this.paymentMethodForm.value.amountCreditLimit):void 0,amountCreditAvailable:this.typeSelected==="Tarjeta de credito"?y.clearNumberFormat(this.paymentMethodForm.value.amountCreditAvailable):void 0,balance:this.typeSelected==="Tarjeta de debito"?y.clearNumberFormat(this.paymentMethodForm.value.balance):void 0}),this.cancelNew(e)}catch(t){this.alertService.addError("Error al agregar el m\xE9todo de pago: "+(t?.message||t))}else this.paymentMethodForm.markAllAsTouched()})}deletePaymentMethod(e){return w(this,null,function*(){(yield this.alertService.addQuestionYoNDanger(`\xBFDesea eliminar ${e.alias}?`,"Eliminar m\xE9todo de pago"))===2&&this.paymentMethodService.delete(e.id).catch(a=>{this.alertService.addError("Error al eliminar el m\xE9todo de pago: "+(a?.message||a))})})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=L({type:n,selectors:[["app-payments-methods"]],hostBindings:function(t,a){t&1&&C("touchstart",function(c){return a.outInteraction(c)},!1,A)("mousedown",function(c){return a.outInteraction(c)},!1,A)},decls:2,vars:1,consts:[["scroll",""],["addElement",""],["item",""],[1,"header"],[1,"title-large"],[1,"scroll"],[1,"content"],[1,"card","paymentMethod",3,"form"],["label","Agregar forma de pago",3,"onClose"],[1,"card","form"],[1,"title-small"],[1,"form-flex"],["autocomplete","off","type","text","name","name","id","name","tabindex","1","placeholder","Nombre/Alias/Concepto","maxlength","10",1,"text-medium","input","full-width",3,"formControl"],["placeHolder","Tarjeta de debito o credito","id","type",1,"full-width",3,"options","formControlApp"],[1,"form-grid"],["autocomplete","off","type","tel","name","balance","id","balance","placeholder","Balance","appCurrency","","tabindex","3",1,"text-medium","input",3,"formControl"],[1,"buttons-add"],[1,"btn-danger",3,"click"],["fontSet","material-symbols-rounded",2,"font-size","24px","color","white"],[1,"btn-success",3,"click"],[1,"card","paymentMethod"],["tabindex","3",1,"btn-danger",3,"click"],["tabindex","4",1,"btn-success",3,"click"],["autocomplete","off","type","tel","name","statementDay","id","statementDay","placeholder","D\xEDa de corte","tabindex","3",1,"text-medium","input","half-width",3,"formControl"],["autocomplete","off","type","tel","name","daysToPay","id","daysToPay","placeholder","D\xEDas para pagar","tabindex","4",1,"text-medium","input","half-width",3,"formControl"],["autocomplete","off","type","tel","name","amountCreditLimit","id","amountCreditLimit","placeholder","Limite de credito","appCurrency","","tabindex","5",1,"text-medium","input","half-width",3,"formControl"],["autocomplete","off","type","tel","name","amountCreditAvailable","id","amountCreditAvailable","placeholder","Credito disponible","appCurrency","","tabindex","6",1,"text-medium","input","half-width",3,"formControl"],[1,"info"],[1,"text-medium"],[1,"actions"],["id","edit",1,"btn-primary",3,"click"],["fontSet","material-symbols-rounded","color","white",2,"font-size","24px"],["id","delete",1,"btn-danger"],["id","delete",1,"btn-danger",3,"click"],[1,"input-wrapper"],[1,"tooltip-container"],["fontSet","material-symbols-rounded",1,"icon-info"],[1,"tooltip-text"],[1,"title-xlarge"]],template:function(t,a){t&1&&g(0,ft,27,7)(1,xt,3,1,"div"),t&2&&M(a.paymentMethods&&!a.errorMessage?0:1)},dependencies:[R,tt,U,Y,Z,X,W,et,q,nt],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:1rem;flex:1 1 auto;overflow:auto;margin:8px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end}.scroll[_ngcontent-%COMP%]{overflow-y:auto;flex:1 1 auto}.content[_ngcontent-%COMP%]{max-width:var(--max-width);margin:0 auto;display:grid;gap:1rem;align-items:start;width:95%;padding:8px}@media (min-width: 600px){.content[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (min-width: 900px){.content[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.card.paymentMethod[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:1rem}.info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:50%;display:flex;align-items:center;justify-content:center;padding:.5rem}.card.form[_ngcontent-%COMP%], .form-flex[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:.5rem}.form-grid[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:85%}.input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;width:100%}.input-wrapper[_ngcontent-%COMP%]   .tooltip-container[_ngcontent-%COMP%]{position:relative;display:inline-block;margin-left:-2rem;cursor:pointer}.input-wrapper[_ngcontent-%COMP%]   .icon-info[_ngcontent-%COMP%]{--icon-size: 20px;font-size:var(--icon-size);width:var(--icon-size);height:var(--icon-size);color:var(--text-color)}.input-wrapper[_ngcontent-%COMP%]   .tooltip-text[_ngcontent-%COMP%]{visibility:hidden;background-color:#333;color:#fff;text-align:left;border-radius:4px;padding:6px 8px;position:absolute;bottom:125%;left:50%;transform:translate(-50%);white-space:nowrap;min-width:100px;max-width:300px;opacity:0;text-wrap:wrap;transition:opacity .2s,visibility .2s;z-index:10}.input-wrapper[_ngcontent-%COMP%]   .tooltip-container[_ngcontent-%COMP%]:hover   .tooltip-text[_ngcontent-%COMP%], .input-wrapper[_ngcontent-%COMP%]   .tooltip-container[_ngcontent-%COMP%]:focus-within   .tooltip-text[_ngcontent-%COMP%]{visibility:visible;opacity:1}.buttons-add[_ngcontent-%COMP%]{display:flex;gap:1rem}.buttons-add[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:1rem;padding:.5rem}"],data:{animation:[K("animate",[k(":enter",[O({opacity:0,transform:"scale(0.8)"}),V("200ms ease-out",O({opacity:1,transform:"scale(1)"}))]),k(":leave",[V("150ms ease-in",O({opacity:0,transform:"scale(0.8)"}))])])]}})};export{it as PaymentsMethodsComponent};
